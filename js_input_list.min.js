// js_ul_list.js
// version : 1.0
// author : Xiao Yuze
// license : MIT
// xiaoyz.me

!function(a){function d(b){b=b||a.event,b.preventDefault?b.preventDefault():b.returnValue=!1}function e(a){var c,b=[];for(c in a)b.push(c+"="+encodeURIComponent(a[c]));return b.join("&")}function f(a){var g,i,j,d="",e=b.getElementById("ul_________append"),f=b.getElementById(c.id);for(g=0,i=a.length;i>g;g++)d+='<li id="li_________append_'+g+'">'+a[g]+"</li>";j=h(f),e.style.top=j.top+j.height+"px",e.style.left=j.left+"px",e.style.width=j.width+"px",e.innerHTML=d,e.style.display="block",c.showul=!0}function h(a){var b,c,d,e;return a?(b=i(a),c=j(a),d=a.clientWidth,e=a.offsetHeight,{top:b,left:c,width:d,height:e}):{top:0,left:0,width:0,height:0}}function i(a){for(var b=a.offsetTop;a=a.offsetParent;)b+=a.offsetTop;return b}function j(a){for(var b=a.offsetLeft;a=a.offsetParent;)b+=a.offsetLeft;return b}function k(b,c,d){a.addEventListener?b.addEventListener(c,d,!1):a.attachEvent&&b.attachEvent("on"+c,d)}function l(a){var b=a.keyCode;13!=b&&186!=b&&37!=b&&39!=b&&27!=b&&40!=b&&9!=b&&38!=b&&("static"!=c.dataType?c.onTyping():c.show())}function m(a){13==a.keyCode||186==a.keyCode?c.onEnter(a):27==a.keyCode?c.onEsc(a):40==a.keyCode||9==a.keyCode?c.onDownArrow(a):38==a.keyCode&&c.onUpArrow(a)}var b=document,c={data:"1,2,3,4,5",data_arr:[],id:"",inited:!1,liLength:0,selectLi:-1,dom:"",showul:!1,dataType:"static",ignoreCase:!1,init:function(a){var c,d;this.data=a.data||this.data,this.id=a.id||"",c=b.getElementById(this.id)||"",this.inited=this.checkInit(),this.ignoreCase=a.ignoreCase||!1,c&&(k(c,"keydown",m),k(c,"keyup",l),k(c,"blur",this.onBlur),k(c,"focus",this.onFocus)),"autocomplete"in c&&(c.autocomplete="off"),d=b.createElement("ul"),d.id="ul_________append",b.body.appendChild(d),this.data_arr=this.data.split(","),this.dataType=a.dataType||this.dataType},checkInit:function(){return this.data&&this.id?!0:!1},setData:function(a){a&&"string"==typeof a&&(this.data=a,this.data_arr=a.split(","))},trigger:function(a){a&&"string"==typeof a&&(this.setData(a),this.show())},getValue:function(){return this.id?b.getElementById(this.id).value:!1},setValue:function(a){return this.id?(b.getElementById(this.id).value=a,void 0):!1},show:function(){var a,b,c,d,g;if(!this.inited)return!1;if(a=this,this.selectLi=-1,b=a.getValue(),a.hide(),b&&(this.ignoreCase?this.ignoreCase&&(c=new RegExp(b,"i")):c=new RegExp(b),a.data.match(c))){for(d=[],g=a.data_arr.length;g;g--)a.data_arr[g-1].match(c)&&d.push(a.data_arr[g-1]);a.liLength=d.length,a.liLength>0&&f(d)}},tagUnselected:function(a){a.className=""},clearActive:function(){var a,b,c;if(a=document.getElementById("ul_________append"))for(b=a.childNodes,c=b.length;c;c--)"active"==b[c-1].className&&this.tagUnselected(b[c-1])},tagselected:function(a){a.className="active"},hide:function(){var a=b.getElementById("ul_________append");a&&(this.selectTag=-1,"block"==a.style.display&&(a.style.display="none"),a.innerHTML="",this.showul=!1)},ajax:function(b,c,d,f){function k(){var b,a="";4==g.readyState&&(200==g.status?(a="success",b=g.responseText,h(b,a)):(a="else",b=g.responseText,h(b,a)))}var g,h,j,i={};if(!b||"string"!=typeof b)return!1;if(b=b.toUpperCase(),"function"==typeof d&&"undefined"==typeof f)h=d;else{if("[object Object]"!=Object.prototype.toString.call(d)||"function"!=typeof f)return!1;i=d,h=f}g=a.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),"GET"==b?(j=e(i),j&&(c+=!c.indexOf("?")>-1?"?"+j:"&"+j),g.onreadystatechange=k,g.open(b,c,!0),g.send()):"POST"==b&&(g.onreadystatechange=k,g.open(b,c,!0),g.setRequestHeader("Content-type","application/x-www-form-urlencoded"),g.send(e(i)))},onTyping:function(a){a()},onBlur:function(){c.hide()},onFocus:function(){c.show()},onEsc:function(){this.hide()},onEnter:function(a){this.showul&&(d(a),this.setValue(this.getActiveValue()),this.hide())},onUpArrow:function(a){var e,f;d(a),this.selectLi>-1&&(this.selectLi-=1,-1==this.selectLi?this.clearActive():(e=b.getElementById("li_________append_"+(+this.selectLi+1)),e&&this.tagUnselected(e),f=b.getElementById("li_________append_"+this.selectLi),f&&this.tagselected(f)))},onDownArrow:function(a){var c,e;return d(a),this.selectLi>=this.liLength-1?!1:(this.selectLi+=1,c=b.getElementById("li_________append_"+(+this.selectLi-1)),c&&this.tagUnselected(c),e=b.getElementById("li_________append_"+this.selectLi),e&&this.tagselected(e),void 0)},getActiveValue:function(){var a=b.getElementById("li_________append_"+this.selectLi);return a.innerHTML}};a.js_input_list=c}(window);